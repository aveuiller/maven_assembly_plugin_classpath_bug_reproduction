# Validate maven assembly jar classpath

During some experiments I found an inconsistent behavior on JAR files with custom classpath
generated using the [maven assembly plugin](https://maven.apache.org/plugins/maven-assembly-plugin/).

This project is here to validate that we can actually build correctly a jar with a custom class-path
entry in the manifest pointing to another jar file.

To try the project, simply run `./try_me_out.sh`. This will run the manual then automated experiments.


# Experiments

## Architecture

We have a library package `jar_1` that we want to package as a JAR and
execute from our src package `exe`, packaged in another JAR file.

- The library code can be found in [./experiment/jar_1](./experiment/jar_1)
- The source code can be found in [./src/main/java/exe](./src/main/java/exe)   

## Manual building

At first, we will try the experiment manually. 
The experiment process can be found in: [./experiment/run_manual.sh](./experiment/run_manual.sh)

In the current state, the experiment works correctly, as we find the output:
```
Trying to load...
...jar_1.ClassInJar1...
Loaded
```

## Automated build

We want to accomplish the same behavior using _maven-assembly-plugin_, which configuration is defined in the [pom.xml](./pom.xml).
The experiment process can be found in: [./experiment/run_automated.sh](./experiment/run_automated.sh)


In the current state, the experiment fails, as we find the output:
```
Trying to load...
...jar_1.ClassInJar1...
Exception in thread "main" java.lang.RuntimeException: java.lang.ClassNotFoundException: jar_1.ClassInJar1
	at exe.MyMain.tryImports(MyMain.java:38)
	at exe.MyMain.main(MyMain.java:16)
Caused by: java.lang.ClassNotFoundException: jar_1.ClassInJar1
	at java.net.URLClassLoader.findClass(URLClassLoader.java:382)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:419)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:352)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:352)
	at exe.MyMain.tryImports(MyMain.java:35)
```

## Manually Rebuild automatically built jar

Unable to understand the difference making the previous test fails, we tried to rebuild the same JAR file 
as will be generated by the _maven-assembly-plugin_, but this time manually.
The experiment process can be found in: [./experiment/run_extract_and_rebuild.sh](./experiment/run_extract_and_rebuild.sh)

In the current state, the experiment works correctly, as we find the output:
```
Trying to load...
...jar_1.ClassInJar1...
Loaded
```
